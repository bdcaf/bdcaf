<!DOCTYPE html>
<html lang="en-us"><head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.7.0">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Clemens Ager">

  
  
  
    
  
  <meta name="description" content="Corona Data analysis for A short description of the project. Created by Clemens Ager clemens.ager@a1.net.
All results are put in the artifacts directory.
Quick start The project can be built typing make.
Example Project When checked out it contains the working example project. This works on CERN Higgs data. It follows the first steps along the Instruction for use of CMS Open Data in R.
If all is setup make will build the project.">

  
  <link rel="alternate" hreflang="en-us" href="/post/dev/datascience/corona/readme/">

  


  
  
  
  <meta name="theme-color" content="#A30000">
  

  
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0-1/css/all.min.css" integrity="sha256-4w9DunooKSr3MFXHXWyFER38WmPdm361bQS/2KUWZbU=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.css" integrity="sha256-SHMGCYmST46SoyGgo4YR/9AlK1vf3ff84Aq9yK4hdqM=" crossorigin="anonymous">
    

    

    
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.1.2/lazysizes.min.js" integrity="sha256-Md1qLToewPeKjfAHU1zyPwOutccPAm5tahnaw7Osw0A=" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    
      

      
      

      
    
      

      
      
        
      

      
    
      

      
      

      
    

  

  
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Code+Pro:400%7COswald:400%7CRaleway%7CMontserrat:600&display=swap">
  

  
  
  
  
  <link rel="stylesheet" href="/css/academic.css">

  




  


  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/images/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_32x32_fill_lanczos_center_2.png">
  <link rel="apple-touch-icon" type="image/png" href="/images/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_192x192_fill_lanczos_center_2.png">

  <link rel="canonical" href="/post/dev/datascience/corona/readme/">

  
  
  
  
  
    
    
  
  
  <meta property="twitter:card" content="summary">
  
  <meta property="twitter:site" content="@c_decaf">
  <meta property="twitter:creator" content="@c_decaf">
  
  <meta property="og:site_name" content="bdcaf">
  <meta property="og:url" content="/post/dev/datascience/corona/readme/">
  <meta property="og:title" content=" | bdcaf">
  <meta property="og:description" content="Corona Data analysis for A short description of the project. Created by Clemens Ager clemens.ager@a1.net.
All results are put in the artifacts directory.
Quick start The project can be built typing make.
Example Project When checked out it contains the working example project. This works on CERN Higgs data. It follows the first steps along the Instruction for use of CMS Open Data in R.
If all is setup make will build the project."><meta property="og:image" content="img/map[gravatar:%!s(bool=false) shape:circle]">
  <meta property="twitter:image" content="img/map[gravatar:%!s(bool=false) shape:circle]"><meta property="og:locale" content="en-us">
  
    
    
  

  


    






  




<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "/post/dev/datascience/corona/readme/"
  },
  "headline": "",
  
  "datePublished": "0001-01-01T00:00:00Z",
  "dateModified": "0001-01-01T00:00:00Z",
  
  "author": {
    "@type": "Person",
    "name": "Clemens Ager"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "bdcaf",
    "logo": {
      "@type": "ImageObject",
      "url": "/images/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_192x192_fill_lanczos_center_2.png"
    }
  },
  "description": "Corona Data analysis for A short description of the project. Created by Clemens Ager clemens.ager@a1.net.\nAll results are put in the artifacts directory.\nQuick start The project can be built typing make.\nExample Project When checked out it contains the working example project. This works on CERN Higgs data. It follows the first steps along the Instruction for use of CMS Open Data in R.\nIf all is setup make will build the project."
}
</script>

  

  


  


  





  <title> | bdcaf</title>

</head>
<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents">

  







<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
    <div class="d-none d-lg-inline-flex">
      <a class="navbar-brand" href="/">bdcaf</a>
    </div>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
      <a class="navbar-brand" href="/">bdcaf</a>
    </div>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#about"><span>Home</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#posts"><span>Posts</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#featured"><span>Publications</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#contact"><span>Contact</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
      

      

      

    </ul>

  </div>
</nav>
<article class="article">

  












  

  
  
  
<div class="article-container pt-3">
  <h1></h1>

  

  
    


<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
    
    0001-01-01
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    5 min read
  </span>
  

  
  
  

  
  

</div>

    














  
</div>



  <div class="article-container">

    <div class="article-style">
      <h1 id="corona">Corona</h1>
<p>Data analysis for A short description of the project.
Created by Clemens Ager <a href="mailto:clemens.ager@a1.net">clemens.ager@a1.net</a>.</p>
<p>All results are put in the <code>artifacts</code> directory.</p>
<h2 id="quick-start">Quick start</h2>
<p>The project can be built typing <code>make</code>.</p>
<h2 id="example-project">Example Project</h2>
<p>When checked out it contains the working example project.
This works on 
<a href="http://opendata.cern.ch/record/300" target="_blank" rel="noopener">CERN Higgs data</a>.
It follows the first steps along the 
<a href="http://opendata.cern.ch/record/5102" target="_blank" rel="noopener">Instruction for use of CMS Open Data in R</a>.</p>
<p>If all is setup <code>make</code> will build the project.
It actually executes <code>make all</code> that has two reports in the <code>artifacts</code> directory as target.</p>
<p>The example project consist of following steps:</p>
<ol start="0">
<li>Obtain input data:
a. 
<a href="http://opendata.cern.ch/record/300" target="_blank" rel="noopener">CERN Higgs data</a> is downloaded to <code>data-raw/</code></li>
<li>Create R data: <code>data-raw/Jpsimumu.csv</code> is read into <code>data/jspi.RDS</code></li>
<li>Manipulate R data: <code>data/jspi.RDS</code> is used to calculate <code>data/mass.RDS</code></li>
<li>Create a markdown report which is then converted to <code>.docx</code> (word)
<code>artifacts/cern.docx</code> via 
<a href="https://pandoc.org/" target="_blank" rel="noopener">pandoc</a></li>
<li>Create a <code>Rnw</code> report which is then rendered with other <code>tex</code> files to
a <code>pdf</code>: <code>artifacts/sample_report.pdf</code> via <code>latexmk</code>.</li>
</ol>
<p>Individual files are created using e.g. <code>make work/transform.RDS</code></p>
<h2 id="idioms">Idioms</h2>
<h3 id="general">General</h3>
<p>This work flow depends on make.</p>
<ul>
<li>Filenames
Make is picky about file names. In particular avoid spaces.
Input data often comes in annoying characters - I find the command 
<a href="https://linux.die.net/man/1/detox" target="_blank" rel="noopener">detox</a> handy for this task.
As this is done to make working with make simpler - this is done outside the makefile.</li>
</ul>
<h3 id="folder-structure">Folder structure</h3>
<p>I came up with following structure.
In particular the folders <code>data</code>, <code>render</code>, <code>artifacts</code> are excluded from git and also may recreate automatically.
The files in folder <code>data-raw</code> are not altered by the scripts.</p>
<h4 id="r">R</h4>
<ul>
<li><code>R</code> holds R commands, these should be loadable with <code>devtools_load_all()</code>.</li>
<li>&lsquo;scripts&rsquo; R scripts that create data and binary files such as images.</li>
<li><code>doc</code> holds <code>Rnw</code> and <code>Rmd</code> files. It can also hole <code>tex</code> and <code>md</code> files which will be just copied over into the render directory.</li>
</ul>
<h4 id="data">data</h4>
<ul>
<li><code>data-raw</code> for unprocessed data. Files in here must not get altered by scripts.</li>
<li><code>data</code> in processed form - <code>Rdata</code> or <code>RDS</code>. Every file in <code>data</code> is created by commands in <code>scripts/</code>.</li>
</ul>
<h4 id="outputs">outputs</h4>
<ul>
<li><code>render</code> - output from <code>Rnw</code> and <code>Rmd</code> files together with their embedded images.  The content of this directory can get deleted.</li>
<li><code>artifacts</code> - completed products</li>
</ul>
<h3 id="script-patterns">Script Patterns</h3>
<h4 id="makefileauto"><code>Makefile.auto</code></h4>
<p>I use the perl script <code>scripts/recursive.pl</code> to walk through a number of files to automatically generate dependencies.
For now I only look for the <code>readRDS</code> command in R code, more definitely to come.
Likely it may not catch some dependencies. Easiest is to add them yourself to the Makefile - or as I prefer an imported one here I called it <code>make.project</code>.
It<code>s difficult to figure out modifications in functions under </code>R<code>. If I depend on them I add them to this file. I also want it to catch included </code>tex` files.</p>
<p>Either way filling in this requirements manually in <code>make.project</code> is no big deal for reasonably sized projects.
For huge ones it pays to adapt <code>scripts/recursive.pl</code>, but I doubt this generalizes.</p>
<h4 id="scriptscreate_mynamer"><code>scripts/create_myname.R</code></h4>
<p>A script to create <code>data/myname.RDS</code>.
By using this pattern the Makefile rule is automatic.</p>
<p>I set it so the target file is also first argument.
That way I don&rsquo;t need to repeat the filename inside the script.
Also makes moving to a different name automatic.</p>
<p>Inside the script end with:</p>
<pre><code class="language-{r}">#save results ------------------------------------------------------------
args &lt;- commandArgs(trailingOnly = TRUE)
saveRDS(mydata, file=args[[1]])
</code></pre>
<h4 id="pattern-for-filewise-conversion">pattern for filewise conversion</h4>
<p>(not included for now)
I have also used pattern that perform the conversion filewise.
E.g. every file in <code>data/signal/</code> should convert to a file in <code>data/filtered/</code>.
I don&rsquo;t think that generalizes well - I write rules just for this task and use wildcards inside the Makefile to setup dependencies.</p>
<h4 id="pattern-for-sub-results">pattern for sub results</h4>
<p>(not included for now)
It sometimes is useful to use the figures created during the render of a <code>Rmd/Rnw</code> render.  E.g. magazines may ask for figures as separate files.
This is not too complicated. E.g. the file <code>doc/sample_calc.Rnw</code> stores its figures under <code>render/reports/sample_calc/</code>.
It is easy to generate individual rules using the pattern. Here it generated <code>my_fig-1.pdf</code>.
Not sure how to generalize this.</p>
<h2 id="tricks">Tricks</h2>
<h3 id="general-1">general</h3>
<ul>
<li>I reference files from the project root. Both in Makefile and also in R. This helps to keep references consistent.</li>
</ul>
<h3 id="r-1">R</h3>
<ul>
<li>
<p>I (ab)use <code>devtools</code>.  In particular often <code>devtools::load_all()</code>.  This requires the folder be named as valid R package and the <code>DESCRIPTION</code> file being valid.  The most common issue that an R package name may only contain characters, numbers and <code>.</code>, and must start with a character.</p>
</li>
<li>
<p>I prefer the RDS data functions. Using plain <code>load</code> made it difficult to figure out where the data came from. Also there was always a risk that variables would be overwritten.</p>
</li>
<li>
<p>In the scripts it gets easier if only one file per <code>create_....R</code> is produced.</p>
</li>
<li>
<p>In tex projects importing several <code>Rnw</code> it can happen that several files use the same label. Haven&rsquo;t found a reliable solution yet. At the moment it probably is best to manually set them.</p>
</li>
<li>
<p>Rnw and Rmd files are rendered into subdirectories. This is necessary as automatic sections will have the same figure names and figures would get overwritten by the next Rmd file.</p>
</li>
</ul>
<h3 id="git">git</h3>
<ul>
<li>git only stores files - not directories. To keep the structure there are empty files <code>.gitkeep</code>.</li>
<li>git does not handle binary files well. Use 
<a href="https://git-lfs.github.com/" target="_blank" rel="noopener">git lfs</a> for binary files like <code>Rdata</code> or preferable store them externally.</li>
</ul>
<h3 id="make">Make</h3>
<ul>
<li>For tasks that are independent on the rest of the project a separate <code>Makefile</code> may be used in a subdir. I perform the download of external data to <code>data-raw</code>. The file <code>data-raw/Makefile</code> contains the code.
Inside the main <code>Makefile</code> I use the code:</li>
</ul>
<pre><code>data-raw/%: data-raw/Makefile
	make -C data-raw $(patsubst data-raw/%,%,$@)
</code></pre>
<p>This way even if <code>data-raw/Makefile</code> defines more data files but those are not used.
Only the required ones should download to save space and bandwidth.</p>
<ul>
<li>
<p>sometimes it&rsquo;s handy to have the data available. Having a <code>data</code> target in the Makefile is useful.</p>
</li>
<li>
<p>It makes things easier when the makefile is split into smaller ones.</p>
</li>
<li>
<p>Projects can be sped up  by using several jobs: e.g. <code>make -j 4</code> uses 4 jobs in parallel.  This works only when the dependencies allow.</p>
</li>
</ul>
<h2 id="plans-for-future-development">Plans for future development</h2>
<ul>
<li>Reorganize <code>data-raw</code> into <code>data/raw</code> and also move the <code>create_</code> scripts there to allow an isolated <code>make data</code></li>
</ul>

    </div>

    







<div class="share-box" aria-hidden="true">
  <ul class="share">
    
      
      
      
        
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=/post/dev/datascience/corona/readme/&amp;text=" target="_blank" rel="noopener" class="share-btn-twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=/post/dev/datascience/corona/readme/&amp;t=" target="_blank" rel="noopener" class="share-btn-facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="mailto:?subject=&amp;body=/post/dev/datascience/corona/readme/" target="_blank" rel="noopener" class="share-btn-email">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=/post/dev/datascience/corona/readme/&amp;title=" target="_blank" rel="noopener" class="share-btn-linkedin">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://web.whatsapp.com/send?text=%20/post/dev/datascience/corona/readme/" target="_blank" rel="noopener" class="share-btn-whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://service.weibo.com/share/share.php?url=/post/dev/datascience/corona/readme/&amp;title=" target="_blank" rel="noopener" class="share-btn-weibo">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
    
  </ul>
</div>












  






  
  
  
    
  
  
  
  <div class="media author-card content-widget-hr">
    
      
      <img class="avatar mr-3 avatar-circle" src="/authors/admin/avatar_hu9b04e5b7aa4cd09e8b079a3c235fbdb8_199807_270x270_fill_lanczos_center_2.png" alt="Avatar">
    

    <div class="media-body">
      <h5 class="card-title"><a href="/">Clemens Ager</a></h5>
      <h6 class="card-subtitle">Number Cruncher</h6>
      
      <ul class="network-icon" aria-hidden="true">
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="/#contact" >
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://twitter.com/c_decaf" target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
    </li>
  
    
    
    
    
    
    
    
      
    
    <li>
      <a href="https://scholar.google.co.uk/citations?user=Agq35HgAAAAJ" target="_blank" rel="noopener">
        <i class="ai ai-google-scholar"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://github.com/bdcaf" target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://at.linkedin.com/in/clemens-ager-1228a295" target="_blank" rel="noopener">
        <i class="fab fa-linkedin"></i>
      </a>
    </li>
  
</ul>

    </div>
  </div>









  
  



  </div>
</article>    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js" integrity="sha256-1zu+3BnLYV9LdiY85uXMzii3bdrkelyp37e0ZyTAQh0=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/r.min.js"></script>
        
      

    

    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.js" integrity="sha256-EErZamuLefUnbMBQbsEqu1USa+btR2oIlCpBJbyD4/g=" crossorigin="anonymous"></script>
    

    
    
    <script>const code_highlighting = true;</script>
    

    
    
    <script>const isSiteThemeDark = false;</script>
    

    

    
    

    

    
    

    
    

    
    

    
    
    
    
    
    
    
    
    
    
    
    
    <script src="/js/academic.min.c97b94000ee75a76d9bc08f5a2e44814.js"></script>

    




<div class="container"><footer class="site-footer">
  

  <p class="powered-by">
    Clemens Ager 2020 &middot; 

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" class="back-to-top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>
</div>
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div></body>
</html>
